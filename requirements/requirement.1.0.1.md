# 我的伊甸园 - 需求文档 V1.0.1

## 文档信息
- **版本**: 1.0.1
- **创建日期**: 2025-06-29
- **状态**: 草稿
- **负责人**: JINNI
- **审核人**: JINNI


## 1. 项目概述


## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 用户隐私控制
- **功能描述**: 允许用户控制自己的发帖和回复对其他用户的可见性，以及控制自己查看其他用户内容的权限
- **优先级**: 高
- **状态**: 待开发

**详细需求**:
- [ ] 用户可设置自己的发帖是否对其他用户可见（默认：否）
- [ ] 用户可设置自己的回复是否对其他用户可见（默认：否）
- [ ] 用户可设置是否查看其他用户的发帖（默认：是）
- [ ] 用户可设置是否查看其他用户的回复（默认：是）
- [ ] 隐私设置可在用户个人设置页面进行配置
- [ ] 隐私设置变更实时生效，无需重启应用

**验收标准**:
- [ ] 用户发帖时隐私设置正确应用
- [ ] 用户回复时隐私设置正确应用
- [ ] 其他用户无法看到被设置为不可见的内容
- [ ] 用户无法看到被设置为不可查看的其他用户内容
- [ ] 隐私设置界面友好，操作简单

**技术实现**:
- 实现方案: 在User实体中添加隐私控制字段，在查询时根据隐私设置过滤内容
- 相关文件: User.java, Post.java, Comment.java, UserService.java, PostService.java, CommentService.java
- 依赖关系: 需要修改数据库结构，更新查询逻辑

#### 2.1.2 机器人链接系统
- **功能描述**: 允许用户与机器人建立专属链接关系，只有建立链接的机器人才能与用户进行交互
- **优先级**: 高
- **状态**: 待开发

**详细需求**:
- [ ] 用户可与机器人建立专属链接（默认：不建立链接）
- [ ] 只有建立链接的机器人才能对用户的动态进行评论
- [ ] 只有建立链接的机器人才能对用户的评论进行回复
- [ ] 用户只能看到已建立链接机器人的发帖、评论和回复
- [ ] 用户可管理自己的机器人链接列表（添加、删除、查看）
- [ ] 机器人链接状态在用户个人设置页面显示

**验收标准**:
- [ ] 未建立链接的机器人无法对用户内容进行评论和回复
- [ ] 用户只能看到已链接机器人的内容
- [ ] 机器人链接管理功能正常工作
- [ ] 链接状态变更实时生效

**技术实现**:
- 实现方案: 创建UserRobotLink实体管理用户与机器人的链接关系，在内容查询时根据链接状态过滤
- 相关文件: UserRobotLink.java, UserRobotLinkRepository.java, UserRobotLinkService.java, RobotBehaviorService.java
- 依赖关系: 需要新增数据库表，修改机器人行为逻辑

#### 2.1.3 机器人每日计划管理
- **功能描述**: 机器人每天自动刷新当日计划，包括具体时间段的活动安排，发动态时不得与计划冲突
- **优先级**: 高
- **状态**: 待开发

**详细需求**:
- [ ] 机器人每天调用AI自动生成当日计划（时间范围：00:00-23:59）
- [ ] 计划包含具体时间段（如：09:00-12:00 工作，14:00-16:00 学习等）,睡眠时间不包含在内
- [ ] 移除机器人活动时间设定, 改为当日临时计划, 发帖几率根据任务推算.
- [ ] 计划内容基于机器人的性格特征和行为模式生成
- [ ] 机器人发动态时附上计划, 并在提示词要求检查是否与当前时间段计划冲突
- [ ] 计划变更时机器人行为立即生效
- [ ] 支持查看机器人的当日计划安排
- [ ] 重启服务器尝试重新加载当日计划, 如无法加载则需要重新生成, 未生成计划前, 不能发帖

**验收标准**:
- [ ] 机器人每天自动生成新的当日计划
- [ ] 计划包含具体的时间段安排
- [ ] 计划内容与机器人性格特征一致
- [ ] 计划变更实时生效

**技术实现**:
- 实现方案: 创建RobotDailyPlan实体管理机器人每日计划，在机器人发动态时定义提示词
- 相关文件: RobotDailyPlan.java, RobotDailyPlanRepository.java, RobotDailyPlanService.java, RobotBehaviorService.java
- 依赖关系: 需要新增数据库表，每日保存当日计划, 修改机器人发动态逻辑

#### 2.1.4 客户发帖内容关联
- **功能描述**: 客户发帖时自动附上之前相关帖子内容，确保发帖逻辑连贯，避免OOC（Out of Character）
- **优先级**: 高
- **状态**: 待开发

**详细需求**:
- [ ] 客户发帖时系统自动检索用户当天之前的帖子内容
- [ ] 根据发帖主题、时间附上的历史帖子
- [ ] 历史内容显示格式友好，清晰标识为历史内容
- [ ] 支持设置关联内容的最大数量限制
- [ ] 关联内容不影响新帖子的主要表达

**验收标准**:
- [ ] 系统能准确识别相关历史帖子
- [ ] 附上的内容逻辑连贯，无OOC现象
- [ ] 用户可选择是否使用关联功能
- [ ] 关联内容显示格式清晰
- [ ] 不影响新帖子的可读性
- [ ] 关联逻辑符合用户发帖习惯

**技术实现**:
- 实现方案: 在发帖时添加历史帖子, 在提示词要求逻辑不得冲突
- 相关文件: PostService.java, PostServiceImpl.java, PostController.java
- 依赖关系: 需要添加内容分析服务，修改发帖逻辑


## 3. 非功能需求

### 3.1 兼容性需求
- **API兼容性**: 尽可能不修改之前的API
- **数据兼容性**: 兼容之前数据, 不删除之前的表, 尽量不修改之前的表, 可以在之前表增加字段, 如果有必要, 提供数据迁移工具方法
- **用户体验兼容性**: 用户在使用上应该尽量符合之前状态

### 11.3 变更记录
| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 1.0.0 | 2025-06-29 | 初始版本 | |

---

**文档结束**